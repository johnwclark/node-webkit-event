<!DOCTYPE html>
<html>
  <head>
    <title>Hello World!</title>
  </head>

<style>
.foo{ border:solid 1px #000; width:300px; height:300px; }
</style>
  <body>

<script>
function openIndexWindow() {
    window.location.assign('index.html');
}
</script>
<input type='button' value='back to index' onclick='openIndexWindow()'>

<script type="text/javascript" src="./js/jquery.min.js"></script>
<script src="./js/raphael-min.js"></script>
<script src="./js/raphael.free_transform.js"></script>
<!--
-->

<div id="drawArea" class="foo"></div>

<script>
// start of my script block
var raf = {};
var rafW = 300;
var rafH = 300;
raf.paper = new Raphael('drawArea', rafW, rafH);
console.log('rafW =' + rafH + ' rafW = ' + rafH);

// added a rectangle
raf.rect1 = raf.paper.rect(10, 10, 30, 30);
raf.rect1.attr({
    fill: 'azure'
});
raf.rect1.click( function () {
    console.log('click rectangle - show coords');
    console.log('x = ' + raf.rect1.attr('x') + ' y = ' + raf.rect1.attr('y'));
    var realX = raf.rect1.matrix.x(raf.rect1.attr('x'),raf.rect1.attr('y'));
    var realY = raf.rect1.matrix.y(raf.rect1.attr('x'),raf.rect1.attr('y'));
    console.log('real x = ' + realX + ' y = ' + realY);
});
raf.rect1.dblclick( function () {
    console.log('dblclick rectangle - rotate 45');
    raf.rect1.rotate(45);
});

// add a free transform element
    var rect = raf.paper
        .rect(100, 100, 50, 50)
        .attr('fill', '#f00')
    ;
    // Add freeTransform to that rect
    var ft = raf.paper.freeTransform(rect)
        .showHandles()
    ;


// Apply transformations programmatically
ft.attrs.rotate = 45;
ft.apply();


// line drawing
var lineDraw = false;
function LineDrawToggle() {
    lineDraw = !lineDraw;
    console.log('lineDraw =' + lineDraw);
};

// mousedown sets the start point
var startX = null;
var startY = null;
var line = {};

// mouse events for line drawing
$('#drawArea').mousedown( function(e) {
    console.log('mousedown');
    if ( lineDraw ) {
        console.log('starting new line');
        startX = e.offsetX;
        startY = e.offsetY;
        line = raf.paper.path( "" );
    }
});

// mouseup sets the end point
$('#drawArea').mouseup( function(e) {
    console.log('mouseup');
    if ( lineDraw ) {
        var endX = e.offsetX;
        var endY = e.offsetY;
        var pathStr = "M" + startX + " " + startY + " L" + endX + " " + endY;
        console.log('path = ' + pathStr);
        line = raf.paper.path( pathStr );
        startX = null;
        startY = null;
    }
});

// mousemove changes the end point and redraws setting the path attr
$('#drawArea').mousemove( function(e) {
    if ( lineDraw && startX ) {
        console.log('redrawing line');
        var endX = e.offsetX;
        var endY = e.offsetY;
        var pathStr = "M" + startX + " " + startY + " L" + endX + " " + endY;
        console.log('path = ' + pathStr);
        // change the attr for the current line
        line.attr("path", pathStr );
    }
});
// end of my script block
</script>

<input type='button' value='line draw toggle' onclick='LineDrawToggle()'>

  </body>
</html>

